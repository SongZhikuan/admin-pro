import{j as _,ae as $,p as R,a7 as I,ab as M,$ as Z,_ as se,i as oe,L as re,R as A,u as T,aF as ae,s as ue,I as j,F as ce}from"./index-86457adf.js";const ie='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',de=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,Ce=e=>Array.from(e.querySelectorAll(ie)).filter(n=>ee(n)&&de(n)),ee=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.tabIndex<0||e.hasAttribute("disabled")||e.getAttribute("aria-disabled")==="true")return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}},ge=function(e,n,...o){let s;n.includes("mouse")||n.includes("click")?s="MouseEvents":n.includes("key")?s="KeyboardEvent":s="HTMLEvents";const a=document.createEvent(s);return a.initEvent(n,...o),e.dispatchEvent(a),e},w="focus-trap.focus-after-trapped",O="focus-trap.focus-after-released",fe="focus-trap.focusout-prevented",q={cancelable:!0,bubbles:!1},le={cancelable:!0,bubbles:!1},W="focusAfterTrapped",J="focusAfterReleased",ve=Symbol("elFocusTrap"),N=_(),L=_(0),k=_(0);let m=0;const te=e=>{const n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0||s===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n},X=(e,n)=>{for(const o of e)if(!Ee(o,n))return o},Ee=(e,n)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(n&&e===n)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},pe=e=>{const n=te(e),o=X(n,e),s=X(n.reverse(),e);return[o,s]},be=e=>e instanceof HTMLInputElement&&"select"in e,l=(e,n)=>{if(e&&e.focus){const o=document.activeElement;let s=!1;$(e)&&!ee(e)&&!e.getAttribute("tabindex")&&(e.setAttribute("tabindex","-1"),s=!0),e.focus({preventScroll:!0}),k.value=window.performance.now(),e!==o&&be(e)&&n&&e.select(),$(e)&&s&&e.removeAttribute("tabindex")}};function Y(e,n){const o=[...e],s=e.indexOf(n);return s!==-1&&o.splice(s,1),o}const Te=()=>{let e=[];return{push:s=>{const a=e[0];a&&s!==a&&a.pause(),e=Y(e,s),e.unshift(s)},remove:s=>{var a,d;e=Y(e,s),(d=(a=e[0])==null?void 0:a.resume)==null||d.call(a)}}},me=(e,n=!1)=>{const o=document.activeElement;for(const s of e)if(l(s,n),document.activeElement!==o)return},z=Te(),Fe=()=>L.value>k.value,F=()=>{N.value="pointer",L.value=window.performance.now()},G=()=>{N.value="keyboard",L.value=window.performance.now()},ye=()=>(R(()=>{m===0&&(document.addEventListener("mousedown",F),document.addEventListener("touchstart",F),document.addEventListener("keydown",G)),m++}),I(()=>{m--,m<=0&&(document.removeEventListener("mousedown",F),document.removeEventListener("touchstart",F),document.removeEventListener("keydown",G))}),{focusReason:N,lastUserFocusTimestamp:L,lastAutomatedFocusTimestamp:k}),y=e=>new CustomEvent(fe,{...le,detail:e});let E=[];const Q=e=>{e.code===Z.esc&&E.forEach(n=>n(e))},_e=e=>{R(()=>{E.length===0&&document.addEventListener("keydown",Q),M&&E.push(e)}),I(()=>{E=E.filter(n=>n!==e),E.length===0&&M&&document.removeEventListener("keydown",Q)})},Le=oe({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[W,J,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const o=_();let s,a;const{focusReason:d}=ye();_e(t=>{e.trapped&&!v.paused&&n("release-requested",t)});const v={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},p=t=>{if(!e.loop&&!e.trapped||v.paused)return;const{code:r,altKey:u,ctrlKey:c,metaKey:i,currentTarget:B,shiftKey:H}=t,{loop:V}=e,ne=r===Z.tab&&!u&&!c&&!i,b=document.activeElement;if(ne&&b){const P=B,[C,g]=pe(P);if(C&&g){if(!H&&b===g){const f=y({focusReason:d.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),V&&l(C,!0))}else if(H&&[C,P].includes(b)){const f=y({focusReason:d.value});n("focusout-prevented",f),f.defaultPrevented||(t.preventDefault(),V&&l(g,!0))}}else if(b===P){const f=y({focusReason:d.value});n("focusout-prevented",f),f.defaultPrevented||t.preventDefault()}}};re(ve,{focusTrapRef:o,onKeydown:p}),A(()=>e.focusTrapEl,t=>{t&&(o.value=t)},{immediate:!0}),A([o],([t],[r])=>{t&&(t.addEventListener("keydown",p),t.addEventListener("focusin",S),t.addEventListener("focusout",h)),r&&(r.removeEventListener("keydown",p),r.removeEventListener("focusin",S),r.removeEventListener("focusout",h))});const U=t=>{n(W,t)},x=t=>n(J,t),S=t=>{const r=T(o);if(!r)return;const u=t.target,c=t.relatedTarget,i=u&&r.contains(u);e.trapped||c&&r.contains(c)||(s=c),i&&n("focusin",t),!v.paused&&e.trapped&&(i?a=u:l(a,!0))},h=t=>{const r=T(o);if(!(v.paused||!r))if(e.trapped){const u=t.relatedTarget;!ae(u)&&!r.contains(u)&&setTimeout(()=>{if(!v.paused&&e.trapped){const c=y({focusReason:d.value});n("focusout-prevented",c),c.defaultPrevented||l(a,!0)}},0)}else{const u=t.target;u&&r.contains(u)||n("focusout",t)}};async function K(){await j();const t=T(o);if(t){z.push(v);const r=t.contains(document.activeElement)?s:document.activeElement;if(s=r,!t.contains(r)){const c=new Event(w,q);t.addEventListener(w,U),t.dispatchEvent(c),c.defaultPrevented||j(()=>{let i=e.focusStartEl;ce(i)||(l(i),document.activeElement!==i&&(i="first")),i==="first"&&me(te(t),!0),(document.activeElement===r||i==="container")&&l(t)})}}}function D(){const t=T(o);if(t){t.removeEventListener(w,U);const r=new CustomEvent(O,{...q,detail:{focusReason:d.value}});t.addEventListener(O,x),t.dispatchEvent(r),!r.defaultPrevented&&(d.value=="keyboard"||!Fe()||t.contains(document.activeElement))&&l(s??document.body),t.removeEventListener(O,x),z.remove(v)}}return R(()=>{e.trapped&&K(),A(()=>e.trapped,t=>{t?K():D()})}),I(()=>{e.trapped&&D(),o.value&&(o.value.removeEventListener("keydown",p),o.value.removeEventListener("focusin",S),o.value.removeEventListener("focusout",h),o.value=void 0)}),{onKeydown:p}}});function Se(e,n,o,s,a,d){return ue(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ae=se(Le,[["render",Se],["__file","focus-trap.vue"]]);export{Ae as E,ve as F,ge as a,ee as i,Ce as o,l as t};
